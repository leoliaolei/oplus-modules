/*! oplus-dts 0.1.0 built at 2018-02-05T14:26:40.154Z*/
angular.module("oplus.dts",["oplus.commons"]),function(){"use strict";angular.module("oplus.dts").config(["$stateProvider",function(t){t.state("app.dts",{url:"/dts",templateUrl:"app/modules/dts/datasource-list.html",controller:"DatasourceListCtrl"}).state("app.dts_datasource_list",{url:"/dts/datasources",templateUrl:"app/modules/dts/datasource-list.html",controller:"DatasourceListCtrl"}).state("app.dts_datasource_new",{url:"/dts/datasources/new",templateUrl:"app/modules/dts/datasource-new.html",controller:"DatasourceNewCtrl",controllerAs:"ctrl"}).state("app.dts_datasource_new.type",{url:"/:type",templateUrl:"app/modules/dts/datasource-edit.html",controller:"DatasourceEditCtrl"}).state("app.dts_datasource_edit",{url:"/dts/datasources/:id/edit",controller:"DatasourceEditCtrl",templateUrl:"app/modules/dts/datasource-edit.html"}).state("app.dts_dataset_new",{url:"/dts/datasources/:datasourceName/datasets/new",templateUrl:"app/modules/dts/dataset-edit.html",controller:"DatasetEditCtrl"}).state("app.dts_dataset_edit",{url:"/dts/datasets/:id/edit",templateUrl:"app/modules/dts/dataset-edit.html",controller:"DatasetEditCtrl"})}])}(),function(){"use strict";function t(t,e){this.getJdbcDrivers=function(){return[{className:"com.ibm.db2.jcc.DB2Driver",urlTemplate:"jdbc:db2://<server>:<port>/<databaseName>",validationQuery:"SELECT 1 FROM sysibm.sysdummy1"},{className:"oracle.jdbc.driver.OracleDriver",urlTemplate:"jdbc:oracle:thin:@<server>:<port>:<databaseName>",validationQuery:"SELECT 1 from dual"},{className:"com.mysql.jdbc.Driver",urlTemplate:"jdbc:mysql://<server>:<port>/<databaseName>",validationQuery:"SELECT 'x'"},{className:"com.microsoft.sqlserver.jdbc.SQLServerDriver",urlTemplate:"jdbc:sqlserver://<server>:<port>;DatabaseName=<databaseName>",validationQuery:"SELECT 'x'"}]},this.findAllDatasources=t.findAllDatasources,this.findDatasource=t.findDatasource,this.saveDatasource=t.saveDatasource,this.deleteDatasource=t.deleteDatasource,this.testConnectivity=function(t){if(!t)throw new Error("Empty argument `datasource`");return angular.isString(t)?e.callApi("dts","GET","/api/dts/datasources/test/{id}",{id:t},null):e.callApi("dts","POST","/api/dts/datasources/test",null,t)},this.doQuery=function(t,n){return e.callApi("dts","post","/api/dts/q/data/{datasetId}",{datasetId:t},{params:n})}}angular.module("oplus.dts").service("datasourceService",t),t.$inject=["datasourceDao","restUtils"]}(),function(){"use strict";function t(t,e,n,a,s){this.findAllDatasets=e.findAllDatasets,this.findDataset=e.findDataset,this.saveDataset=e.saveDataset,this.deleteDataset=e.deleteDataset,this.copyDataset=e.copyDataset,this.queryDatasetMeta=function(n){function a(t){var e;return angular.isArray(t)?e=t:(e=[],Object.keys(t).forEach(function(n){s({name:n,type:t[n]},"").forEach(function(t){e.push(t)})})),e}function s(t,e){var n,a,r,o=[],l=t.type,i=t.name;return!l||angular.isString(l)?a=l:angular.isArray(l)?l.length>0?(a="array",n=l[0],l.length>1&&console.warn("Array type only support one definition")):console.warn("Cannot find field definition in array"):angular.isObject(l)&&(a="object",n=l),r=e?e+"."+i:i,"array"===a&&(r+="[]",a="array-暂不支持"),o.push({name:r,type:a}),n&&Object.keys(n).forEach(function(t){s({name:t,type:n[t]},r).forEach(function(t){o.push(t)})}),o}var r=t.defer();return e.queryDatasetMeta(n).then(function(t){r.resolve({fields:a(t.fields),paramsConfig:t.paramsConfig})}).catch(function(t){r.reject(t)}),r.promise},this.queryDataset=function(n,a){var r=t.defer(),o=JSON.stringify({code:n,params:a}),l="数据集["+n+"]出现连续的查询失败";return s.stopOverError(o,l,function(t){return r.reject(t),r.promise}),e.queryDataset(n,a).then(function(t){r.resolve(t),s.clearError(o)}).catch(function(t){s.accumulateError(o),r.reject(t)}),r.promise},this.queryDataTable=function(n,r,o,l){var i=t.defer(),c=JSON.stringify({code:n,params:r}),d="数据集["+n+"]出现连续的查询失败";return s.stopOverError(c,d,function(t){return i.reject(t),i.promise}),e.queryDataTable(n,r,o).then(function(t){s.clearError(c),i.resolve(t)}).catch(function(t){s.accumulateError(c),i.reject(t),l&&a.alertError("数据集查询错误",t.message)}),i.promise},this.testQuery=function(t){return n.callApi("dts","POST","/api/dts/q/meta",null,t)}}angular.module("oplus.dts").service("datasetService",t),t.$inject=["$q","datasetDao","restUtils","messageService","errorHandler"]}(),function(){"use strict";function t(){var t=!1;this.useLocalDb=function(e){t=e},this.$get=["_datasourceLocalDao","_datasourceRemoteDao",function(e,n){return t?e:n}]}angular.module("oplus.dts").provider("datasourceDao",t),t.$inject=[]}(),function(){"use strict";function t(t){var e=t.createDao("oplus.dts.datasources");this.findAllDatasources=e.findAllEntities,this.findDatasource=e.findEntity,this.saveDatasource=e.saveEntity,this.deleteDatasource=e.deleteEntity}angular.module("oplus.dts").service("_datasourceLocalDao",t),t.$inject=["localDaoFactory"]}(),function(){"use strict";function t(t){this.findAllDatasources=function(){return t.callApi("dts","GET","/api/dts/datasources")},this.findDatasource=function(e){return t.callApi("dts","GET","/api/dts/datasources/{id}",{id:e})},this.saveDatasource=function(e){return e.id?t.callApi("dts","PUT","/api/dts/datasources",null,e):t.callApi("dts","POST","/api/dts/datasources",null,e)},this.deleteDatasource=function(e){return t.callApi("dts","DELETE","/api/dts/datasources/{id}",{id:e})}}angular.module("oplus.dts").service("_datasourceRemoteDao",t),t.$inject=["restUtils"]}(),function(){"use strict";function t(t){var e=!1;this.useLocalDb=function(t){e=t},this.isLocalDb=e,this.$get=["_datasetLocalDao","_datasetRemoteDao",function(t,n){return e?t:n}]}angular.module("oplus.dts").provider("datasetDao",t),t.$inject=[]}(),function(){"use strict";function t(t,e,n){function a(t){var n=_.find(o,{code:t});if(!n)throw new ReferenceError('Local dataset "'+t+'" is not defined');if(!n.service)throw new ReferenceError('Local dataset "'+t+'" has no service');var a=e.get(n.service);if(!a)throw new ReferenceError('Cannot find service instance for local dataset "'+t+'"');return a}function s(e,n){try{return a(e).queryData(e,n)}catch(e){return t(function(t,n){n(e)})}}var r=n.createDao("oplus.dts.datasets"),o=[];this.deleteDataset=r.deleteEntity,this.findDataset=r.findEntity,this.saveDataset=r.saveEntity,this.findAllDatasets=function(){return t(function(t,e){t(o)})},this.queryDatasetMeta=function(e){try{return a(e).queryMeta(e)}catch(e){return t(function(t,n){n(e)})}},this.queryDataset=s,this.queryDataTable=function(e,n,a){var r=t.defer(),o={};return s(e,n).then(function(t){var e=t.records;a.length>0&&(e=t.records.slice(a.start,a.start+a.length)),o.recordsTotal=t.total,o.recordsFiltered=t.records.length,o.data=e,o.draw=a.draw,r.resolve(o)}).catch(function(t){r.reject(t)}),r.promise},this.defineLocalDataset=function(t,e,n){o.push({code:t,name:e,service:n})}}angular.module("oplus.dts").service("_datasetLocalDao",t),t.$inject=["$q","$injector","localDaoFactory"]}(),function(){"use strict";function t(t,e){var n=this;this.findAllDatasets=function(){return e.callApi("dts","GET","/api/dts/datasets")},this.findDataset=function(t){return e.callApi("dts","GET","/api/dts/datasets/{id}",{id:t})},this.saveDataset=function(t){return t.id?e.callApi("dts","PUT","/api/dts/datasets",null,t):e.callApi("dts","POST","/api/dts/datasets",null,t)},this.deleteDataset=function(t){return e.callApi("dts","DELETE","/api/dts/datasets/{id}",{id:t})},this.copyDataset=function(t,n){return e.callApi("dts","GET","/api/dts/datasets/copy/{id}",{id:t},{code:n})},this.queryDatasetMeta=function(t){return e.callApi("dts","GET","/api/dts/q/meta/{code}/",{code:t})},this.queryDataset=function(t,n){return e.callApi("dts","POST","/api/dts/q/data/{code}/",{code:t},{params:n})},this.queryDataTable=function(e,a,s){console.warn("TODO: this is a temp solution, need implement in serverside");var r=t.defer(),o={};return n.queryDataset(e,a).then(function(t){var e=t.records;s.length>0&&(e=t.records.slice(s.start,s.start+s.length)),o.recordsTotal=t.total,o.recordsFiltered=t.records.length,o.data=e,o.draw=s.draw,r.resolve(o)}).catch(function(t){r.reject(t)}),r.promise}}angular.module("oplus.dts").service("_datasetRemoteDao",t),t.$inject=["$q","restUtils"]}(),function(){"use strict";function t(t,e,n){function a(t){return l[t].cursor+1>=(l[t].numOfGroups||0)}function s(t){return(i[t]||{}).dataset}function r(e,a){console.log("pullDataFromDao",e,a);var r=t.defer(),l=s(e);return n.queryDataset(l,a).then(function(t){var e=o(t.records,a.GROUPBY,a.GROUPBY_ARG);t.numOfGroups=e,r.resolve(t)}).catch(function(t){throw t}),r.promise}function o(t,e,n){var a,s=0;"BATCH"===e?a=Math.ceil(t.length/parseInt(n)):"AMOUNT"===e&&(a=parseInt(n));for(var r=[],o=0;o<t.length;o++){var l=t[o];if("FIELD"===e){var i=l[n],c=r.indexOf(i);c>=0?l._group=c:(r.push(i),l._group=r.length-1)}else"AMOUNT"!==e&&"BATCH"!==e||(l._group=Math.floor(o/a));s=l._group+1}return s}var l={records:[],lastRead:0},i={};this.queryData=function(e,n){function s(){var t=l[e].cursor;return l[e].cursor++,_.filter(l[e].records,function(e){return e._group===t})||[]}var o=t.defer();if(l[e]=l[e]||{records:[],numOfGroups:0,cursor:0},a(e))r(e,n).then(function(t){l[e]={records:t.records,numOfGroups:t.numOfGroups,cursor:0},o.resolve({records:s()})}).catch(function(t){throw t});else{var i={records:s()};o.resolve(i)}return o.promise},this.queryMeta=function(e){var a,r=t.defer(),o=s(e);return n.queryDatasetMeta(o).then(function(t){(a=t).paramsConfig.GROUPBY={type:"string",required:!0,desc:"分组条件，支持AMOUNT、BATCH、FIELD"},a.paramsConfig.GROUPBY_ARG={type:"string",required:!0,desc:"分组条件的参数值，对应每组数量，几组，字段名称"},r.resolve(a)}).catch(function(t){throw t}),r.promise},this.defineDataset=function(t,n,a){i[t]={dataset:n},e.defineLocalDataset(t,a,"clientCacheDataset")}}angular.module("oplus.dts").service("clientCacheDataset",t),t.$inject=["$q","_datasetLocalDao","datasetDao"],angular.module("oplus.dts").run(["_datasetLocalDao","clientCacheDataset",function(t,e){e.defineDataset("CACHE_UP_REALTIME","UP_实时交易量","UP_实时交易量（缓存）")}])}(),function(){"use strict";function t(t){function e(){return Math.floor(255*Math.random())+1+"."+(Math.floor(255*Math.random())+0)+"."+(Math.floor(255*Math.random())+0)+"."+(Math.floor(255*Math.random())+0)}function n(t,e){return(Math.random()>.5?1:-1)*Math.round(Math.random()*e)+t}function a(a){for(var s=a._streamLastUpdate,r=Date.now()-s,o={total:Math.floor(r/1e3),records:[]},l=moment(s),i=0;i<o.total;i++)l.add(1,"s"),o.records.push({timestamp:l.toDate(),passIn:a.param_passIn,message:a.param_passIn+" message",ip:e(),number:n(100,100)});return t(function(t,e){t(o)})}function s(a){for(var s=a.param_numOfRecord||10,r={total:s,records:[]},o=moment().subtract(10*s,"s"),l=r.total;l>0;l--)r.records.push({timestamp:o.toDate(),passIn:a.param_passIn,message:Date.now()+"",ip:e(),cpu:n(60,20),memory:n(80,10),number:n(100,100),constantString:"constant",store:{bicycle:{color:"red",price:n()}}}),o.add(10,"s");return t(function(t,e){t(r)})}this.queryMeta=function(e){var n=[{name:"timestamp",type:"date"},{name:"message",type:"string"},{name:"ip",type:"string"},{name:"cpu",type:"number"},{name:"memory",type:"number"},{name:"passIn",type:"string"},{name:"number",type:"number"},{name:"object",type:"object"},{name:"constantString",type:"string"},{name:"user",type:{name:"string",age:"number",friends:[{}]}}];n={timestamp:"date",message:"string",ip:"string",passIn:"string",number:"number",cpu:"number",memory:"number",tags:[{name:"string",weight:"number"}],store:{books:[{title:"string",author:"string",price:"number"}],bicycle:{color:"string",price:"number"}}};var a={param_date:{defaultValue:"",desc:"fake parameter",required:!0},param_query:{desc:"User input query",required:!1},param_passIn:{desc:"输入的参数原样返回，用以验证能够接受参数"},param_numOfRecord:{defaultValue:1,type:"number",desc:"返回的数据个数",required:!0}};return t(function(t,e){t({fields:n,paramsConfig:a})})},this.queryData=function(e,n){return n._streamLastUpdate?a(n):"SIMULATE_QUERY_ERROR"===n.param_query?t(function(t,e){e(new Error("SIMULATE_QUERY_ERROR"))}):s(n)}}var e=angular.module("oplus.dts");e.service("mockJsDataset",t),e.run(["_datasetLocalDao","mockJsDataset",function(t,e){t.defineLocalDataset("JS_MOCK_DATASET","JS_MOCK_DATASET","mockJsDataset")}]),t.$inject=["$q"]}(),function(){"use strict";function t(t,e){function n(e){var n=[];t.readWorkbook().then(function(t){t.SheetNames.forEach(function(t){n.push({code:t,name:t,desc:"desc="+t})}),e(n)})}var a=!1;this.registerDatasets=function(){a||(n(function(t){t.forEach(function(t){e.defineLocalDataset(t.code,t.name,"mockExcelDataset")})}),a=!0)},this.findAllDatasets=n,this.queryMeta=function(e){return t.getSheetColumnMeta(e)},this.queryData=function(e,n){return t.readWorksheet(e,n)}}angular.module("oplus.dts").service("mockExcelDataset",t),t.$inject=["excelMockData","_datasetLocalDao"],_appconfig.modules.udp.useLocalDb&&angular.module("oplus.dts").run(["mockExcelDataset",function(t){console.debug("mockExcelDataset.registerDatasets"),t.registerDatasets()}])}(),function(){"use strict";function t(t,e,n,a,s,r,o,l){function i(){r.findAllDatasources().then(function(e){t.datasources=e,t.selectedDatasource=t.datasources.find(function(e){return e.name===t.dataset.datasource})})}function c(n){var a=[];angular.forEach(n.fields,function(t){a.push({data:t.name,title:t.name,defaultContent:""})}),t.tableOption={data:n.records,columns:a,searching:!1,paging:!0,scrollX:"100%"};$("#dataTable").html(e('<table id="table" width="100%" class="table table-striped m-b-none"></table>')(t)),d($("#table"),"DataTable",t.tableOption)}function d(t,e,n){var a=new Array;return a.push(n),t[e].apply(t,a)}var u=a.id,p=a.datasourceName;t.editing=!1,t.saveDataset=function(){t.dataset.datasource=t.selectedDatasource.name,t.dataset.type=t.selectedDatasource.type,o.saveDataset(t.dataset).then(function(t){s.toast("success","Saved"),n.go("app.dts_datasource_list")}).catch(function(t){throw t})},t.deleteDataset=function(t){o.deleteDataset(t).then(function(){n.go("app.dts_datasource_list")})},t.copyDataset=function(t){s.prompt("","请输入code","",function(e){o.copyDataset(t,e).then(function(t){s.toast("success","copyed"),n.go("app.dts_datasource_list")})},"")},t.queryMeta=function(e){n={};angular.forEach(t.dataset.params,function(t,e){n[e]=t.defaultValue});var n={proc:t.dataset.options.proc,type:t.dataset.type,dataSource:t.selectedDatasource.name,params:n,query:t.dataset.query};o.testQuery(n).then(function(n){"param"==e?t.dataset.params=n.paramsConfig:"data"==e&&c(n)}).catch(function(t){s.alert("失败",t.message)})},t.addQueryParam=function(){t.dataset.params=t.dataset.params||{},t.dataset.params[""]={}},t.removeQueryParam=function(e){delete t.dataset.params[e]},t.changeParam=function(e,n){var a=0,s={};angular.forEach(t.dataset.params,function(t,r){e==a?s[n]=t:s[r]=t,a++}),t.dataset.params=s},t.cmOption={lineNumbers:!0,lineWrapping:!0,indentWithTabs:!0,theme:"solarized dark",mode:"sql"},function(e){e?(t.editing=!0,o.findDataset(e).then(function(e){t.dataset=e,null==t.dataset.options&&"jdbc"==t.dataset.type&&(t.dataset.options={proc:!1}),i()}).catch(function(t){throw t})):(t.dataset={datasource:p,options:{proc:!1}},i())}(u)}angular.module("oplus.dts").controller("DatasetEditCtrl",t),t.$inject=["$scope","$compile","$state","$stateParams","messageService","datasourceService","datasetService","$templateRequest"]}(),function(){"use strict";angular.module("oplus.dts").controller("DatasourceNewCtrl",function(){this.dsTypes=[{type:"jdbc",label:"JDBC数据库"},{type:"es",label:"ElasticSearch"},{type:"file",label:"文件",disabled:!0},{type:"mongo",label:"MongoDB",disabled:!0},{type:"hbase",label:"HBase",disabled:!0},{type:"rest",label:"REST API",disabled:!0}]})}(),function(){"use strict";function t(t,e,n,a,s,r,o,l,i){var c=s.id,d=s.type;t.editing=!1;var u="";t.saveDatasource=function(){p.beforeSave(),o.saveDatasource(t.datasource).then(function(e){t.editing=!0,t.datasource=e,u=t.datasource.config.password,p.initProps(),r.toast("success","Saved")}).catch(function(t){throw t})},t.testConnectivity=function(){t.datasource.id?o.testConnectivity(t.datasource).then(function(e){r.alertSuccess("成功","测试成功"),t.datasourceResponseData=e}).catch(function(t){r.alertError("失败",t.message)}):r.toast("info","请先保存数据源。")};var p={initProps:function(){"jdbc"===t.datasource.type?(t.jdbcDrivers=o.getJdbcDrivers(),t.datasource.config=t.datasource.config||{},t.changeJdbcDriver=function(){var e=t.datasource.config.driver,n=_.find(t.jdbcDrivers,{className:e});t.selectedDriver=n,t.datasource.config.validationQuery=t.selectedDriver.validationQuery},u=t.datasource.config.password):"es"===t.datasource.type&&(t.datasource.config=t.datasource.config||{query:'{"query":{"match_all":{}}}'})},beforeSave:function(){"jdbc"===t.datasource.type&&u==t.datasource.config.password&&delete t.datasource.config.password}};c?(t.editing=!0,o.findDatasource(c).then(function(e){t.datasource=e,p.initProps()}).catch(function(t){throw t})):(t.datasource={type:d},p.initProps())}angular.module("oplus.dts").controller("DatasourceEditCtrl",t),t.$inject=["$scope","$compile","$timeout","$state","$stateParams","messageService","datasourceService","$templateRequest","restUtils"]}(),function(){"use strict";function t(t,e,n,a,s){function r(){n.findAllDatasources().then(function(e){t.datasources=e}).catch(function(t){throw t})}t.deleteDatasource=function(t){e.confirm("删除","确认删除数据源"+t.name+"？",function(){n.deleteDatasource(t.id).then(function(){r()})},function(){})},t.showRestApi=function(t){var e=s.open({animation:!1,templateUrl:"app/modules/dts/rest-api.html",controller:["dataset","$scope",function(t,n){var a=_appconfig.apiBaseUrls.dts||window.location.protocol+"//"+window.location.host+window.location.pathname;n.restApi=a+"/api/dts/q/data/"+t.code+"/";var s=n.restApi,r={};if(t.params){s+="?params=%7B",angular.forEach(t.params,function(t,e){r[e]=t.defaultValue});var o=angular.toJson(r);s+=o.substring(1,o.length-1),s+="%7D"}n.getUrl=s,n.params=r,n.dismissModal=function(){e.close()}}],controllerAs:"$ctrl",resolve:{dataset:function(){return t}},size:"md"})},r()}angular.module("oplus.dts").controller("DatasourceListCtrl",t),t.$inject=["$scope","messageService","datasourceService","datasetService","$uibModal"]}(),function(t){try{t=angular.module("oplus.dts")}catch(e){t=angular.module("oplus.dts",[])}t.run(["$templateCache",function(t){"use strict";t.put("app/modules/dts/dataset-edit.html",'<nav class="navbar navbar-default b-b">\n    <div class="container-fluid">\n        <div class="navbar-header">\n            <ol class="breadcrumb">\n                <li><a ui-sref="app.dts">数据服务</a></li>\n                <li class="active">编辑数据集</li>\n            </ol>\n        </div>\n    </div>\n</nav>\n\n<div class="wrapper">\n    <div class="row">\n        <div class="col-md-12">\n            <form class="form-horizontal panel panel-default" ng-submit="saveDataset()">\n                <div class="panel-heading clearfix">\n                    <div class="pull-right">\n                        <div class="btn-group" dropdown>\n                            <button type="button" class="btn btn-default" data-toggle="dropdown">\n                                <i class="fa fa-ellipsis-v"></i>\n                            </button>\n                            <ul class="dropdown-menu" role="menu">\n                                <li><a ng-click="copyDataset(dataset.id)"><i class="fa fa-copy"></i> 复制</a></li>\n                                <li><a ng-click="deleteDataset(dataset.id)"><i class="fa fa-remove"></i> 删除</a></li>\n                            </ul>\n                        </div>\n                    </div>\n                </div>\n                <div class="panel-body">\n                    \x3c!--<div class="bg-light text-center img-circle m-r" style="width:48px">--\x3e\n                    \x3c!--<i class="fa fa-2x fa-datasource-{{selectedDatasource.type}}" style="line-height:48px"></i>--\x3e\n                    \x3c!--</div>--\x3e\n\n                    <div class="form-group">\n                        <label class="col-sm-2 control-label" for="f_code" required>code (唯一)*</label>\n                        <div class="col-sm-10">\n                            <input ng-readonly="editing" ng-model="dataset.code" class="form-control" id="f_code">\n                        </div>\n                    </div>\n\n                    <div class="form-group">\n                        <label class="col-sm-2 control-label" for="f_name" required>名称 *</label>\n                        <div class="col-sm-10">\n                            <input ng-model="dataset.name" class="form-control" id="f_name">\n                        </div>\n                    </div>\n\n                    <div class="form-group">\n                         <label class="col-sm-2 control-label" for="f_description">说明</label>\n                         <div class="col-sm-10">\n                            <textarea type="text" ng-model="dataset.description" class="form-control" id="f_description"\n                            rows="3"></textarea>\n                         </div>\n                    </div>\n\n                    <div class="form-group">\n                        <label class="col-sm-2 control-label" for="f_datasource" required>数据源 *</label>\n                        <div class="col-sm-10">\n                            <select  ng-model="selectedDatasource" class="form-control" id="f_datasource"\n                                    ng-options="ds as ds.name +\' [\' + ds.type + \']\' for ds in datasources"></select>\n                        </div>\n                    </div>\n\n\n\n                    <div ng-if="selectedDatasource.type != \'\' && selectedDatasource.type != null" ng-include="\'app/modules/dts/dataset-query-\'+selectedDatasource.type+\'.html\'"></div>\n\n                    <div class="form-group">\n                        <div class="col-sm-10 col-sm-offset-2">\n                            <button type="button" ng-click="queryMeta(\'data\')" class="btn btn-primary pull-right">执行测试查询\n                            </button>\n                            <button class="btn btn-success">保存</button>\n                            <button type="button" class="btn btn-default" ui-sref="app.dts">取消</button>\n                        </div>\n\n                    </div>\n\n\n                    <div class="form-group">\n\n                        <label class="col-sm-2 control-label">\n                            测试数据\n                        </label>\n\n                        <div class="col-sm-10" >\n                            <div  id="dataTable"></div>\n                        </div>\n\n                    </div>\n\n                </div>\n            </form>\n        </div>\n        \x3c!--<div class="col-md-3"></div>--\x3e\n    </div>\n    \x3c!--<div class="panel panel-default">--\x3e\n    \x3c!--<div class="panel-heading h4">测试结果</div>--\x3e\n    \x3c!--<div class="panel-body">--\x3e\n    \x3c!--<pre>{{datasetTestResult | json}}</pre>--\x3e\n    \x3c!--&lt;!&ndash;<uwidget uw-type="datatable" uw-props=""></uwidget>&ndash;&gt;--\x3e\n    \x3c!--</div>--\x3e\n    \x3c!--</div>--\x3e\n</div>\n'),t.put("app/modules/dts/dataset-query-es.html",'<div class="form-group">\n    <label class="col-sm-2 control-label" for="input_query" required>查询json *</label>\n    <div class="col-sm-10">\n        <textarea ui-codemirror="{mode:\'application/json\', lineNumbers:true, theme:\'solarized dark\', lineWrapping:true}"\n                  xclass="form-control code" rows="6" id="input_query" ng-model="dataset.query"></textarea>\n    </div>\n</div>\n<div class="form-group">\n    <div class="col-sm-10 col-sm-offset-2">\n        <button type="button" ng-click="queryMeta(\'param\')" class="btn btn-primary pull-right">获取参数</button>\n    </div>\n</div>\n\n<div class="form-group">\n    <label class="col-sm-2 control-label">查询参数</label>\n    <div class="col-sm-10">\n        <table class="table op-param-table">\n            <thead>\n            <tr>\n                <th>参数\n                    <button type="button" class="btn btn-xs btn-primary" ng-click="addQueryParam()" title="添加参数"><i\n                            class="fa fa-plus"></i></button>\n                </th>\n                <th>类型</th>\n                <th>测试值</th>\n                <th>说明</th>\n                <th>必需</th>\n                <th>Action</th>\n            </tr>\n            </thead>\n            <tbody>\n            <tr ng-repeat="(name,detail) in dataset.params track by $index">\n\n                <td><input type="text" class="form-control" ng-model="name" ng-change="changeParam($index,name)"></td>\n                <td>\n                    <select class="form-control" ng-model="detail.type">\n                        <option value="String">String</option>\n                        <option value="Integer">Integer</option>\n                        <option value="Double">Double</option>\n                        <option value="Date">Date</option>\n                        <option value="BigDecimal">BigDecimal</option>\n                        <option value="Text">Text</option>\n                        <option value="Blob">Blob</option>\n                    </select>\n                </td>\n                <td><input type="text" class="form-control" ng-model="detail.defaultValue"></td>\n                <td><input type="text" class="form-control" ng-model="detail.desc"></td>\n                <td><label class="i-checks m-b-none"><input type="checkbox" name="display_panel"\n                                                            ng-model="detail.required"><i></i></label>\n                </td>\n                <td>\n                    <button type="button" class="btn btn-default" ng-click="removeQueryParam(name)"><i\n                            class="fa fa-remove"></i></button>\n                </td>\n            </tr>\n            </tbody>\n        </table>\n    </div>\n</div>\n'),t.put("app/modules/dts/dataset-query-file.html",'<div class="form-group">\n    <label class="col-sm-2 control-label" for="input_query">查询语句</label>\n    <div class="col-sm-10">\n                <textarea ui-codemirror="{mode:\'text/x-sql\', lineNumbers:true, theme:\'solarized dark\', lineWrapping:true}"\n                          xclass="form-control code" rows="6" id="input_query" ng-model="dataset.query"></textarea>\n    </div>\n</div>\n'),t.put("app/modules/dts/dataset-query-jdbc.html",'<div class="form-group">\n    <label class="col-sm-2 control-label" for="is_proc" required>是否存储过程 *</label>\n    <div class="col-sm-10">\n        <div class="checkbox" id="is_proc">\n            <label class="i-checks">\n                <input type="checkbox" ng-model="dataset.options.proc" class="ng-valid ng-dirty ng-valid-parse ng-touched ng-empty" style=""><i></i></label>\n        </div>\n    </div>\n</div>\n\n<div class="form-group">\n    <label class="col-sm-2 control-label" for="input_query" required>查询SQL *</label>\n    <div class="col-sm-10">\n        <textarea ui-codemirror="{mode:\'text/x-sql\', lineNumbers:true, theme:\'solarized dark\', lineWrapping:true}"\n                  xclass="form-control code" rows="6" id="input_query" ng-model="dataset.query"></textarea>\n    </div>\n</div>\n<div class="form-group">\n    <div class="col-sm-10 col-sm-offset-2">\n        <button type="button" ng-click="queryMeta(\'param\')" class="btn btn-primary pull-right">获取参数</button>\n    </div>\n</div>\n\n<div class="form-group">\n    <label class="col-sm-2 control-label">查询参数</label>\n    <div class="col-sm-10">\n        <table class="table op-param-table">\n            <thead>\n            <tr>\n                <th>参数\n                    <button type="button" class="btn btn-xs btn-primary" ng-click="addQueryParam()" title="添加参数"><i\n                            class="fa fa-plus"></i></button>\n                </th>\n                <th>类型</th>\n                <th>测试值</th>\n                <th>说明</th>\n                <th>必需</th>\n                <th>Action</th>\n            </tr>\n            </thead>\n            <tbody>\n            <tr ng-repeat="(name,detail) in dataset.params track by $index">\n\n                <td><input type="text" class="form-control" ng-model="name" ng-change="changeParam($index,name)"></td>\n                <td>\n                    <select class="form-control" ng-model="detail.type">\n                        <option value="String">String</option>\n                        <option value="Number">Number</option>\n                        <option value="Date">Date</option>\n                        <option value="Boolean">Boolean</option>\n                    </select>\n                </td>\n                <td><input type="text" class="form-control" ng-model="detail.defaultValue"></td>\n                <td><input type="text" class="form-control" ng-model="detail.desc"></td>\n                <td><label class="i-checks m-b-none"><input type="checkbox" name="display_panel"\n                                                            ng-model="detail.required"><i></i></label>\n                </td>\n                <td>\n                    <button type="button" class="btn btn-default" ng-click="removeQueryParam(name)"><i\n                            class="fa fa-remove"></i></button>\n                </td>\n            </tr>\n            </tbody>\n        </table>\n    </div>\n</div>\n'),t.put("app/modules/dts/dataset-query-localexcel.html",'<div class="form-group">\n    <label class="col-sm-2 control-label" for="input_query" required>查询SQL *</label>\n    <div class="col-sm-10">\n        <textarea class="form-control code" rows="6" id="input_query" ng-model="dataset.query"></textarea>\n    </div>\n</div>\n<div class="form-group">\n    <label class="col-sm-2 control-label">查询参数</label>\n    <div class="col-sm-10">\n        <table class="table op-param-table">\n            <thead>\n            <tr>\n                <th>参数\n                    <button type="button" class="btn btn-xs btn-primary" ng-click="addQueryParam()" title="添加参数"><i class="fa fa-plus"></i></button>\n                </th>\n                <th>说明</th>\n                <th>必需</th>\n                <th>Action</th>\n            </tr>\n            </thead>\n            <tbody>\n            <tr ng-repeat="param in dataset.params track by $index">\n                <td><input type="text" class="form-control" ng-model="param.name"></td>\n                <td><input type="text" class="form-control" ng-model="param.desc"></td>\n                <td><label class="i-checks m-b-none"><input type="checkbox" name="display_panel"\n                                                            ng-model="param.required"><i></i></label>\n                </td>\n                <td>\n                    <button type="button" class="btn btn-default" ng-click="removeQueryParam($index)"><i\n                            class="fa fa-remove"></i></button>\n                </td>\n            </tr>\n            </tbody>\n        </table>\n    </div>\n</div>\n'),t.put("app/modules/dts/dataset-query-rest.html",'<div class="form-group">\n    <label class="col-sm-2 control-label" for="input_query">REST查询语句</label>\n    <div class="col-sm-10">\n        <textarea ui-codemirror="{mode:\'text/x-sql\', lineNumbers:true, theme:\'solarized dark\', lineWrapping:true}"\n                  xclass="form-control code" rows="6" id="input_query" ng-model="dataset.query"></textarea>\n    </div>\n</div>'),t.put("app/modules/dts/datasource-edit-es.html",'<form class="panel panel-default form-horizontal" ng-submit="saveDatasource()">\n    <div class="panel-heading">ElasticSearch 数据源</div>\n    <div class="panel-body">\n        <div class="form-group">\n            <label class="col-sm-2 control-label" for="input_name">name（唯一）</label>\n            <div class="col-sm-10">\n                <input type="text" ng-model="datasource.name" class="form-control" id="input_name">\n            </div>\n        </div>\n        <div class="form-group">\n            <label class="col-sm-2 control-label" for="input_url">地址</label>\n            <div class="col-sm-10">\n                <input type="url" class="form-control" id="input_url" ng-model="datasource.config.url">\n            </div>\n        </div>\n        <div class="form-group">\n            <label class="col-sm-2 control-label" for="input_query">测试语句</label>\n            <div class="col-sm-10">\n                <input type="text"   class="form-control" id="input_query" ng-model="datasource.config.query">\n            </div>\n        </div>\n        <div class="form-group">\n            <div class="col-sm-10 col-sm-offset-2">\n                <button type="button" ng-click="testConnectivity()" class="btn btn-primary pull-right">测试连通性</button>\n                <button class="btn btn-success">保存</button>\n                <button type="button" class="btn btn-default" ui-sref="app.dts_datasource_list">取消</button>\n            </div>\n        </div>\n    </div>\n</form>\n'),t.put("app/modules/dts/datasource-edit-file.html",'<form class="panel panel-default form-horizontal" ng-submit="saveDatasource()">\n    <div class="panel-heading">文件类型数据源 <span class="label label-default">{{datasource.type}}</span></div>\n    <div class="panel-body">\n        <div class="form-group">\n            <label class="col-sm-2 control-label" for="input_name">ID（唯一）</label>\n            <div class="col-sm-10">\n                <input type="text" ng-model="datasource.name" class="form-control" id="input_name">\n            </div>\n        </div>\n        <div class="form-group">\n            <label class="col-sm-2 control-label" for="input_file">数据文件</label>\n            <div class="col-sm-10">\n                <input type="file" ng-model="datasource.file" class="form-control" id="input_file">\n                <p class="text-muted">支持格式：xls、xlsx、csv</p>\n            </div>\n        </div>\n        <div class="form-group">\n            <div class="col-sm-offset-2 col-sm-10">\n                <button type="submit" class="btn btn-success">保存</button>\n                <button type="button" class="btn btn-default" ui-sref="app.dts_datasource_list">取消</button>\n            </div>\n        </div>\n    </div>\n</form>\n'),t.put("app/modules/dts/datasource-edit-jdbc.html",'<form class="panel panel-default form-horizontal" ng-submit="saveDatasource()">\n    <div class="panel-heading">JDBC类型数据源 <span class="label label-default">{{datasource.type}}</span></div>\n    <div class="panel-body">\n        <div class="form-group">\n            <label class="col-sm-2 control-label" for="_id">name（唯一）</label>\n            <div class="col-sm-10">\n                <input ng-readonly="editing" ng-model="datasource.name" class="form-control" id="_id">\n            </div>\n        </div>\n        <div class="form-group">\n            <label class="col-sm-2 control-label" for="_jdbc_url">JDBC URL</label>\n            <div class="col-sm-10">\n                <input ng-model="datasource.config.url" class="form-control" id="_jdbc_url">\n            </div>\n        </div>\n        <div class="form-group">\n            <label class="col-sm-2 control-label" for="_jdbc_driver">JDBC Driver</label>\n            <div class="col-sm-10">\n\n                <select ng-model="datasource.config.driver" class="form-control" id="_jdbc_driver"\n                        ng-change="changeJdbcDriver()"\n                        ng-options="driver.className as driver.className for driver in jdbcDrivers"></select>\n\n                <div ng-if="selectedDriver" class="input-group m-t">\n                    <span class="input-group-addon">JDBC URL样例</span>\n                    <input class="form-control" disabled value="{{selectedDriver.urlTemplate}}">\n                    <span class="input-group-btn"><button type="button" class="btn btn-default"><i class="fa fa-copy"></i> </button></span>\n                </div>\n\n                <div  class="input-group m-t">\n                    <span class="input-group-addon">验证语句</span>\n                    <input ng-model="datasource.config.validationQuery"  class="form-control"  >\n                </div>\n\n            </div>\n        </div>\n        <div class="form-group">\n            <label class="col-sm-2 control-label" for="input_jdbc_username">用户名</label>\n\n            <div class="col-sm-10">\n                <input ng-model="datasource.config.username" class="form-control" id="input_jdbc_username">\n            </div>\n        </div>\n        <div class="form-group">\n            <label class="col-sm-2 control-label" for="input_jdbc_password">密码</label>\n            <div class="col-sm-10">\n                <input  type="password" ng-model="datasource.config.password" class="form-control"\n                       id="input_jdbc_password">\n            </div>\n        </div>\n\n        <div class="form-group">\n            <label class="col-sm-2 control-label" for="_description">说明</label>\n            <div class="col-sm-10">\n                            <textarea type="text" ng-model="datasource.description" class="form-control" id="_description"\n                                      rows="3"></textarea>\n            </div>\n        </div>\n\n\n    </div>\n    <div class="panel-footer">\n        <div class="row">\n            <div class="col-sm-10 col-sm-offset-2">\n                <button type="button" class="btn btn-primary pull-right" ng-click="testConnectivity()">测试连通性</button>\n                <button type="submit" class="btn btn-success">保存</button>\n                <button type="button" class="btn btn-default" ui-sref="app.dts_datasource_list">取消</button>\n            </div>\n        </div>\n    </div>\n</form>\n'),t.put("app/modules/dts/datasource-edit-localexcel.html",'<form class="panel panel-default form-horizontal" ng-submit="saveDatasource()">\n    <div class="panel-heading">文件类型数据源 <span class="label label-default">{{datasource.type}}</span></div>\n    <div class="panel-body">\n        <div class="form-group">\n            <label class="col-sm-2 control-label" for="input_name">ID（唯一）</label>\n            <div class="col-sm-10">\n                <input type="text" ng-model="datasource.name" class="form-control" id="input_name">\n            </div>\n        </div>\n        <div class="form-group">\n            <label class="col-sm-2 control-label" for="input_file">Excel路径URL</label>\n            <div class="col-sm-10">\n                <input type="text" ng-model="datasource.fileUri" class="form-control" id="input_file">\n                <p class="text-muted">支持格式：xls、xlsx、csv</p>\n            </div>\n        </div>\n        <div class="form-group">\n            <div class="col-sm-offset-2 col-sm-10">\n                <button type="submit" class="btn btn-success">保存</button>\n                <button type="button" class="btn btn-default" ui-sref="app.dts_datasource_list">取消</button>\n            </div>\n        </div>\n    </div>\n</form>\n'),t.put("app/modules/dts/datasource-edit-rest.html",'<form class="panel panel-default form-horizontal" ng-submit="saveDatasource()">\n    <div class="panel-heading">RESTful API数据源</div>\n    <div class="panel-body">\n        <div class="form-group">\n            <label class="col-sm-2 control-label" for="input_name">ID（唯一）</label>\n            <div class="col-sm-10">\n                <input type="text" ng-model="datasource.name" class="form-control" id="input_name">\n            </div>\n        </div>\n        <div class="form-group">\n            <label class="col-sm-2 control-label" for="input_code">CURL</label>\n            <div class="col-sm-10">\n                <textarea class="form-control" rows="10" id="input_code" ng-model="datasource.rest.curl"></textarea>\n            </div>\n        </div>\n        <div class="form-group">\n            <div class="col-sm-10 col-sm-offset-2">\n                <button type="button" ng-click="testConnectivity()" class="btn btn-primary pull-right">测试连通性</button>\n                <button class="btn btn-success">保存</button>\n                <button type="button" class="btn btn-default" ui-sref="app.dts_datasource_list">取消</button>\n            </div>\n        </div>\n    </div>\n</form>\n'),t.put("app/modules/dts/datasource-edit.html",'<nav class="navbar navbar-default b-b">\n    <div class="container-fluid">\n        <div class="navbar-header">\n            <ol class="breadcrumb">\n                <li><a ui-sref="app.dts">数据服务</a></li>\n                <li class="active">编辑数据源</li>\n            </ol>\n        </div>\n    </div>\n</nav>\n<div class="hbox">\n    <div ng-if="datasource.type != \'\' && datasource.type != null" class="wrapper" ng-include="\'app/modules/dts/datasource-edit-\' + datasource.type + \'.html\'"></div>\n    <div class="wrapper" ng-if="datasourceResponseData">\n        <div class="panel panel-default">\n            <div class="panel-heading">测试结果</div>\n            <div class="panel-body">\n                <pre style="max-height: 400px; overflow: auto">{{datasourceResponseData|json}}</pre>\n            </div>\n        </div>\n    </div>\n</div>\n'),t.put("app/modules/dts/datasource-layout.html",'<div ui-view=""></div>'),t.put("app/modules/dts/datasource-list.html",'<nav class="navbar navbar-default b-b">\n    <div class="container-fluid">\n        <div class="navbar-header">\n            <ol class="breadcrumb">\n                <li class="active">数据服务</li>\n            </ol>\n        </div>\n    </div>\n</nav>\n<div class="wrapper">\n    <div xclass="panel-body">\n        <div class="list-group">\n            <div class="list-group-item clearfix">\n                <a ui-sref="app.dts_datasource_new" class="btn btn-primary pull-right"><i\n                        class="fa fa-plus"></i> 新建</a>\n                <h4>数据源 ({{datasources.length}})</h4>\n            </div>\n            <div ng-if="datasources.length===0" class="list-group-item vbox">\n                <div class="op-blank-wrapper">\n                    <div class="op-blank-content">\n                        <i class="fa fa-inbox op-fa-8x"></i>\n                        <p>还没有定义任何数据源</p>\n                    </div>\n                </div>\n            </div>\n            <div ng-repeat="datasource in datasources" class="list-group-item clearfix">\n                <div class="pull-left bg-light text-center img-circle m-r" style="width:48px">\n                    <i class="fa fa-2x fa-datasource-{{::datasource.type}}" style="line-height:48px"\n                       title="{{::datasource.type}}"></i>\n                </div>\n                <div class="pull-right">\n                    <a class="btn btn-default" ui-sref="app.dts_datasource_edit({id:datasource.id})"><i\n                            class="fa fa-pencil" title="修改"></i> </a>\n                    <a class="btn btn-default" ng-click="deleteDatasource(datasource)"><i\n                            class="fa fa-remove" title="删除"></i> </a>\n                    <a class="btn btn-default" ui-sref="app.dts_dataset_new({datasourceName:datasource.name})"><i\n                            class="fa fa-cube" title="新建数据集"></i> </a>\n                </div>\n                <div class="clear">\n                    <span class="h4"> {{::datasource.name}}</span>\n                    <div class="m-t-sm">\n                        <ul class="list list-unstyled inline m-b-xs" ng-repeat="dataset in datasource.datasetDTOList">\n                            <li class="m-r"><a class="label label-default"\n                                               ui-sref="app.dts_dataset_edit({id:dataset.id})">{{dataset.name}}</a>\n                                <label style="cursor: pointer;" ng-click="showRestApi(dataset)"\n                                       class="label-success label">api</label>\n                            </li>\n                        </ul>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n'),t.put("app/modules/dts/datasource-new.html",'<div ui-view="">\n    <nav class="navbar navbar-default b-b">\n        <div class="container-fluid">\n            <div class="navbar-header">\n                <ol class="breadcrumb">\n                    <li><a ui-sref="app.dts">数据服务</a></li>\n                    <li class="active">新建数据源</li>\n                </ol>\n            </div>\n        </div>\n    </nav>\n    <div class="hbox hbox-auto-xs">\n        <div class="m panel panel-default">\n            <div class="panel-body">\n                <p>选择数据源类型</p>\n                <div class="row">\n                    <div class="col-xs-3 text-center" ng-repeat="ds in ::ctrl.dsTypes track by $index">\n                        <a ui-sref="app.dts_datasource_new.type({type:ds.type})" style="display:inline-block">\n                            <div class="img-circle lt text-center" ng-class="ds.disabled?\'bg-light\':\'bg-primary\'" style="width:96px"><i\n                                    class="fa fa-datasource-{{::ds.type}} fa-4x text-light" style="line-height:96px"></i></div>\n                            <h4>{{::ds.label}}</h4></a>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>'),t.put("app/modules/dts/rest-api.html",'<form class="form-horizontal">\n\n\n    <div class="modal-header">\n        <button type="button" class="close" data-dismiss="modal" ng-click="dismissModal()">×</button>\n        <h3 class="modal-title">Rest Api</h3>\n    </div>\n\n\n    <div class="modal-body">\n\n        <uib-tabset>\n            <uib-tab>\n                <uib-tab-heading><i class=\'fa fa-link\'></i> URL <span class="label label-warning">GET</span>\n                </uib-tab-heading>\n                <div class="wrapper-sm">\n                    <p>\n                        接口访问地址\n                    </p>\n                    <div class="input-group">\n                        <input type="text" class="form-control"\n                               ng-model="getUrl" id="js-text1">\n                <span class="input-group-btn">\n                    <button type="button"\n                            class="btn btn-defaul"\n                            ngclipboard=""\n                            data-clipboard-target="#js-text1">\n                        <i class="fa fa-clipboard"></i></button>\n                    <button type="button"\n                            class="btn btn-defaul"\n                        >\n                        <a ng-href="{{getUrl}}" target="_blank"><i class="fa fa-link" ></i></a></button>\n                </span>\n                    </div>\n                </div>\n            </uib-tab>\n            <uib-tab>\n                <uib-tab-heading><i class=\'fa fa-link\'></i> URL <span class="label label-warning">POST</span>\n                </uib-tab-heading>\n                <div class="wrapper-sm">\n                    <p>\n                        接口访问地址\n                    </p>\n                    <div class="input-group">\n                        <input type="text" class="form-control"\n                               ng-model="restApi" id="js-text2">\n                            <span class="input-group-btn">\n                                <button type="button"\n                                        class="btn btn-defaul"\n                                        ngclipboard=""\n                                        data-clipboard-target="#js-text2">\n                                    <i class="fa fa-clipboard"></i></button>\n                            </span>\n                    </div>\n                    <br>\n                    <p>\n                        接口访问参数\n                    </p>\n\n                    <div>\n                        <pre>{{params|json}}</pre>\n                    </div>\n\n                </div>\n            </uib-tab>\n        </uib-tabset>\n\n\n    </div>\n\n\n</form>\n'),t.put("app/modules/dts/curl/parse-curl.html",'\n<!DOCTYPE html>\n<html>\n<head>\n    <title>cURL to Fetch</title>\n    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">\n    <link href="data:image/x-icon;base64,AAABAAEAEBAQAAEABAAoAQAAFgAAACgAAAAQAAAAIAAAAAEABAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAA////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABEQAAAAAAAAERAAAAAAAAAREAAAAAAAARERAAAAAAAREREQAAAAARERERAAAAARERAREAARERERAAAAABERERAAAAAAERERAAAAAAAAAREAAAAAAAABEQAAAAAAAAERAAAAAAAAAAAAAAAAD//wAA/48AAP8HAAD/BwAA/wcAAP4DAAD8AQAA+AEAAIABAAAAIwAAAH8AAAD/AACA/wAA4P8AAOD/AADx/wAA" rel="icon" type="image/x-icon" />\n    <style type="text/css">\n        html {\n            background: #282A36;\n            color: #6272A4;\n            font-family: monospace;\n        }\n\n        #copy-alert {\n            width: 120px;\n            text-align: center;\n            margin: 0px auto;\n            transform: translateY(-40px);\n            opacity: 0;\n            animation-duration: 1s;\n        }\n\n        #copy-alert.pop {\n            animation-name: slidein;\n        }\n\n        #copy-button {\n            cursor: pointer;\n            color: #FF79C6;\n            background: #1c1d24;\n            padding: 10px;\n            width: 120px;\n            text-align: center;\n            margin: 0 auto;\n        }\n\n        #copy-button.pop {\n            color: #6272A4;\n        }\n\n        @keyframes slidein {\n            from {\n                transform: translateY(10px);\n                opacity: 100;\n            }\n            to {\n                transform: translateY(-40px);\n                opacity: 0;\n            }\n        }\n        pre {\n            width: 540px;\n            color: #BFBEB8;\n            margin: 0 auto 32px;\n            text-shadow: 0 0 11px #2A2A33, 1px 1px 1px #141419;\n        }\n        .pop, .ui, h2 {\n            cursor: default;\n            user-select: none;\n            -webkit-user-select: none;\n            -moz-user-select: none;\n            -ms-user-select: none;\n        }\n\n        body {\n            padding-top: 60px;\n            max-width: 960px;\n            margin: 0 auto;\n        }\n\n        #input, #result {\n            background: #1C1D24;\n            border-radius: 2px;\n            padding: 10px;\n        }\n\n        #input {\n            box-sizing: border-box;\n            width: 100%;\n            resize: none;\n            overflow: hidden;\n            min-height: 50px;\n            border: 0;\n            color: #6272A4;\n        }\n\n        .error { color: #FF79C6; }\n        #result {\n            word-break: break-all;\n            white-space: pre-wrap;\n            color: grey;\n            outline: none;\n        }\n\n        textarea::selection {\n            color: white;\n        }\n        ::selection, #result span::selection {\n            background: #9b99b7;\n        }\n\n        .keyword { color: #50FA7B; }\n        .value { color: #F1FA8C; }\n        .key { color: #FFB86C; }\n        .url { color: #66d9ef; }\n        .keyword::selection { color: #abffc0; }\n        .value::selection { color: #f7fbd1; }\n        .key::selection { color: #ffd9b1; }\n        .url::selection { color: #acf2ff; }\n\n\n    </style>\n    <script type="text/javascript">\n        "use strict"\n        try {\n            eval([\n                \'let wesh = ({ sup }, [ destructuring ]) => {\',\n                \'  // arrow fat yey\',\n                \'  return `template ${sup}string`\',\n                \'}\',].join(\'\\n\'))\n        } catch (err) {\n            window.location = \'/fetch/old-js.html\'\n        }\n    <\/script>\n</head>\n<body>\n<h2>&lt;&lt;&lt;&lt; from cURL...</h2>\n<textarea tabindex=1 id="input" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"></textarea>\n<h2 style="text-align: right;">...to fetch &gt;&gt;&gt;&gt;</h2>\n<pre id="error"></pre>\n<div id="result" tabindex=2></div>\n<div id="copy-alert">copied !</div>\n<div id="copy-button" class="ui">copy</div>\n<script>\n    \'use strict\'\n    // generic\n    // parse url https://gist.github.com/jed/964849\n    const parseUrl = (function (a){return function(b,c,d){a.href=b;c={};for(d in a)if(""+a[d]===a[d])c[d]=a[d];return c}}(document.createElement("a")))\n\n    // http://stackoverflow.com/questions/6139107\n    const selectElementContents = el => {\n        const range = document.createRange()\n        range.selectNodeContents(el)\n        const sel = window.getSelection()\n        sel.removeAllRanges()\n        sel.addRange(range)\n    }\n\n    const clearSelection = () => {\n        if (document.selection) {\n            document.selection.empty()\n        } else if (window.getSelection) {\n            window.getSelection().removeAllRanges()\n        }\n    }\n\n    // copieur\n    const copieur = (src, button, a) => {\n        button || (button = document.getElementById(\'copy-button\'))\n        a || (a = document.getElementById(\'copy-alert\'))\n\n        function whichTransitionEvent() {\n            var t\n            var el = document.createElement(\'fakeelement\')\n            var transitions = {\n                transition:\'transitionend\',\n                OTransition:\'oTransitionEnd\',\n                MozTransition:\'transitionend\',\n                WebkitTransition:\'webkitTransitionEnd\'\n            }\n\n            for (t in transitions) {\n                if (el.style[t]) return transitions[t]\n            }\n        }\n        var inPopState = false\n        function removeAlert() {\n            inPopState = false\n            a.classList.remove(\'pop\')\n            button.classList.remove(\'pop\')\n        }\n\n        var transition = whichTransitionEvent()\n        if (transition) {\n            a.addEventListener(transition, removeAlert)\n        }\n\n        return button.onclick = function copyOnClick() {\n            if (!inPopState) {\n                console.log(\'copyinge\')\n                inPopState = true\n                a.classList.add(\'pop\')\n                button.classList.add(\'pop\')\n                if (!transition) {\n                    setTimeout(removeAlert, 1000)\n                }\n            }\n            var success\n            var focusedElement = document.activeElement\n            selectElementContents(src)\n            try {\n                success = document.execCommand(\'copy\')\n            } catch (err) {\n                success = false\n            }\n            clearSelection()\n            if (!success) {\n                prompt(\'Oldschool copy box for you\', src.textContent)\n            }\n            setTimeout(function() { focusedElement.focus() }, 10);\n        }\n    }\n\n\n    // taken from npm/parse-curl\n    const scan = (str, pattern, callback) => {\n        let result = ""\n        while (str.length > 0) {\n            const match = str.match(pattern)\n            if (match) {\n                result += str.slice(0, match.index)\n                result += callback(match)\n                str = str.slice(match.index + match[0].length)\n            } else {\n                result += str\n                str = ""\n            }\n        }\n    }\n\n    const splitReg = /\\s*(?:([^\\s\\\\\\\'\\"]+)|\'((?:[^\\\'\\\\]|\\\\.)*)\'|"((?:[^\\"\\\\]|\\\\.)*)"|(\\\\.?)|(\\S))(\\s|$)?/\n\n    const split = line => {\n        if (line === undefined) line = ""\n\n        const words = []\n        let field = ""\n        scan(line, splitReg, ([ raw, word, sq, dq, escape, garbage, seperator ]) => {\n            if (garbage !== undefined) throw Error("Unmatched quote")\n        field += word || (sq || dq || escape).replace(/\\\\(?=.)/, "")\n        if (seperator !== undefined) {\n            words.push(field)\n            field = ""\n        }\n    })\n        if (field) {\n            words.push(field)\n        }\n        return words\n    }\n\n    const rewrite = baseArgs => baseArgs.reduce((args, a) => {\n        if (a.indexOf(\'-X\') === 0) {\n        args.push(\'-X\')\n        args.push(a.slice(2))\n    } else {\n        args.push(a)\n    }\n\n    return args\n    }, [])\n\n    const matchUrl = /((^https?:\\/\\/)|(^(?:[0-9]{1,3}\\.){3}[0-9]{1,3})|localhost)/\n    const addArg = (currentValue, arg) => currentValue\n        ? currentValue +\'&\'+ arg\n        : arg\n    const parseCurl = s => {\n'+"        if (0 != s.indexOf('curl ')) throw Error('Missing curl keyword')\n        let out = { method: 'GET', headers: {} }\n        let state = ''\n        let urlParams = ''\n        let fallbackUrl = ''\n        rewrite(split(s)).forEach(arg => {\n            switch (true) {\n        case matchUrl.test(arg):\n            out.url = arg\n            break\n\n        case arg == '-A' || arg == '--user-agent':\n            state = 'user-agent'\n            break\n\n        case arg == '-H' || arg == '--header':\n            state = 'header'\n            break\n\n        case arg == '-d' || arg == '--data' || arg == '--data-ascii':\n            state = 'data'\n            break\n\n        case arg == '--data-urlencode':\n            state = 'url'\n            break\n\n        case arg == '-u' || arg == '--user':\n            state = 'user'\n            break\n\n        case arg == '-I' || arg == '--head':\n            out.method = 'HEAD'\n            break\n\n        case arg == '-X' || arg == '--request':\n            state = 'method'\n            break\n\n        case arg == '-b' || arg =='--cookie':\n            state = 'cookie'\n            break\n\n        case arg == '--compressed':\n            out.headers['Accept-Encoding'] = out.headers['Accept-Encoding'] || 'deflate, gzip'\n            break\n\n        case !!arg:\n            switch (state) {\n                case 'header':\n                    const delimIndex = arg.indexOf(':')\n                    out.headers[arg.slice(0, delimIndex)] = arg.slice(delimIndex + 1).trim()\n                    state = ''\n                    break\n                case 'user-agent':\n                    out.headers['User-Agent'] = arg\n                    state = ''\n                    break\n                case 'url':\n                    urlParams = addArg(urlParams, arg)\n                    state = ''\n                    break\n                case 'data':\n                    out.headers['Content-Type'] = out.headers['Content-Type'] || 'application/x-www-form-urlencoded'\n                    out.body = addArg(out.body, arg)\n                    state = ''\n                    break\n                case 'user':\n                    out.headers['Authorization'] = 'Basic '+ btoa(arg)\n                    state = ''\n                    break\n                case 'method':\n                    out.method = arg\n                    state = ''\n                    break\n                case 'cookie':\n                    out.headers['Set-Cookie'] = arg\n                    state = ''\n                    break\n            }\n            break\n        default:\n            fallbackUrl = arg\n            break\n        }\n    })\n\n        if (urlParams) {\n            out.url = out.url + (parseUrl(out.url).search ? '&' : '?') + urlParams\n        }\n\n        return out\n    }\n\n    // specific code\n    const _id = document.getElementById.bind(document)\n    const _textArea = _id('input')\n    const _result = _id('result')\n    const isNotEmpty = obj => obj && Object.keys(obj).length > 0\n    const isObj = obj => obj.constructor === Object || !obj.constructor\n    const _class = (className, text) => `<span class=\"${className}\">${text}</span>`\n    const _quote = (className, text) =>\n    `\"<span class=\"${className}\">${JSON.stringify(text).slice(1, -1)}</span>\"`\n    const classes = [ 'keyword', 'key', 'value', 'url' ]\n\n\n    classes.forEach(key => {\n        _class[key] = t => _class(key, t)\n    _class[key].text = t => _quote(key, t)\n    })\n\n    const _base = _class.keyword('fetch')\n\n    /* options :\n     - Extra comma\n     - referer\n     - cookies\n     - User-Agent\n     - Connection\n     - Accept(s)\n     - Cache-Control + Pragma\n     - always quotes\n     //\n     * Features\n     - highlight url and url options\n     - set spacer\n    */\n    const matchLegalChars = /^[a-zA-Z$_][$_a-zA-Z0-9]+$/\n    const spacer = '  ' // 2 spaces, you know it\n    const noCase = (a, b) => a.toLowerCase().localeCompare(b.toLowerCase())\n    const formatOpts = (indent, opts) => '{\\n'+ Object.keys(opts).sort(noCase)\n        .map(key => {\n        const rawVal = opts[key]\n        if (!rawVal) return\n    const legalKey = matchLegalChars.test(key)\n        ? _class.key(key)\n        : _class.key.text(key)\n\n    return `${indent}${legalKey}: ${isObj(rawVal)\n        ? formatOpts(indent + spacer, rawVal)\n        : _class.value.text(rawVal) }`\n    }).filter(Boolean).join(',\\n') + `\\n${indent.slice(spacer.length)}}`\n\n    const formatFetch = (url, opts) => isNotEmpty(opts)\n        ? `${_base}(${_class.url(JSON.stringify(url))}, ${formatOpts(spacer, opts)})`\n        : `${_base}(${_class.url(JSON.stringify(url))})`\n\n    const printResult = (url, opts) => _result.innerHTML = formatFetch(url, opts)\n\n    let _prevError = ''\n    let _prevInput = ''\n    let _prevHeight = 50\n    let _forceResize = false\n    const update = () => {\n        try {\n            const newInput = _textArea.value\n            if (_prevInput === newInput) return\n            if (newInput.length < _prevInput.length) {\n                // force resize\n                _textArea.style.height = '5px'\n                _forceResize = true\n            }\n\n            localStorage.save = _prevInput = newInput\n\n            // update height\n            const { scrollHeight, style } = _textArea\n            if (_forceResize || scrollHeight !== _prevHeight) {\n                style.height = (_prevHeight = Math.max(50, scrollHeight)) +'px'\n                _forceResize = false\n            }\n\n            // update render\n            const { method, headers, url, body } = parseCurl(newInput)\n            const opts = {}\n            if (method !== 'GET') opts.method = method\n            if (isNotEmpty(headers)) opts.headers = headers\n            if (isNotEmpty(body)) opts.body = body\n            printResult(url, opts)\n        } catch (err) {\n            if (_prevError !== err.message) {\n                _prevError = err.message\n                console.error(err)\n            }\n            _result.innerHTML = `<span class=\"error\">${err.message}</span>`\n        }\n    }\n\n    const loop = () => update(requestAnimationFrame(loop))\n\n    _textArea.value = localStorage.save\n        ? localStorage.save\n        : 'curl https://kigiri.github.io/fetch/'\n\n    _result.onfocus = () => selectElementContents(_result)\n    window.onfocus = _textArea.onfocus = () => _textArea.select()\n    _textArea.onblur = _result.onblur = clearSelection\n\n    loop()\n\n    copieur(_result)\n<\/script>\n</body>\n</html>\n")}])}();